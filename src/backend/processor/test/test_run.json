{
  "projectSettings": {
    "clusters": [
      {
        "clusterId": "A",
        "name": "CY5"
      },
      {
        "clusterId": "B",
        "name": "CY7"
      },
      {
        "clusterId": "C",
        "name": "cell area"
      },
      {
        "clusterId": "D",
        "name": "coloc cy5-cy7"
      }
    ],
    "classes": [
      {
        "classId": "A",
        "name": "EV"
      },
      {
        "classId": "A",
        "name": "cell"
      },
      {
        "classId": "A",
        "name": "background"
      },
      {
        "classId": "A",
        "name": "ev in cell"
      },
      {
        "classId": "A",
        "name": "coloc"
      },
      {
        "classId": "A",
        "name": "Invalid"
      }
    ],
    "imageSetup": {
      "zStackHandling": "IntensityProjection",
      "tStackHandling": "ExactOne",
      "imageInputDirectory": "test/test_data/images"
    },
    "outputDirectory": "tmp"
  },
  "pipelines": [
    {
      "pipelineSetup": {
        "source": "FromFile",
        "cStackIndex": 3,
        "zProjection": "MaxIntensity",
        "defaultClusterId": "A"
      },
      "pipelineSteps": [
        {
          "$blur": {
            "kernelSize": 7,
            "repeat": 5
          }
        },
        {
          "$threshold": {
            "node": "Manual",
            "thresholdMin": 10,
            "thresholdMax": 65535
          }
        },
        {
          "$watershed": {}
        },
        {
          "$classify": {
            "classifiers": [
              {
                "clusterOutNoMatch": "$",
                "classOutNoMatch": "None",
                "modelClassId": 65535,
                "filters": [
                  {
                    "clusterOut": "$",
                    "classOut": "C0",
                    "minParticleSize": -1,
                    "maxParticleSize": -1,
                    "minCircularity": 0,
                    "snapAreaSize": 0
                  }
                ]
              }
            ]
          }
        },
        {
          "$measure": {
            "clustersIn": [
              "$"
            ],
            "classesIn": [
              "C0"
            ],
            "planesIn": [
              {
                "imageIdx": "MaxIntensity",
                "imagePlane": {
                  "cStack": 3
                }
              }
            ]
          }
        },
        {
          "$imageFromClass": {
            "classesIn": [
              "C0"
            ]
          }
        },
        {
          "$saveImage": {
            "compression": 0,
            "namePrefix": "_classified_A",
            "objectCluster": "$"
          }
        },
        {
          "$voronoi": {
            "pointsClusterIn": "A",
            "pointsClassIn": [
              "C0"
            ],
            "pointsClusterOut": "G",
            "pointsClassOut": "C8",
            "excludeAreasWithoutPoint": true,
            "excludeAreasAtTheEdge": false,
            "maxRadius": 100
          }
        },
        {
          "$imageFromClass": {
            "clusterIn": "G",
            "classesIn": [
              "C8"
            ]
          }
        },
        {
          "$saveImage": {
            "compression": 0,
            "namePrefix": "_voronoi_A",
            "objectCluster": "G"
          }
        }
      ]
    },
    {
      "pipelineSetup": {
        "source": "FromFile",
        "cStackIndex": 2,
        "zProjection": "MaxIntensity",
        "defaultClusterId": "B"
      },
      "pipelineSteps": [
        {
          "$blur": {
            "kernelSize": 7,
            "repeat": 5
          }
        },
        {
          "$threshold": {
            "node": "Manual",
            "thresholdMin": 10,
            "thresholdMax": 65535
          }
        },
        {
          "$watershed": {}
        },
        {
          "$classify": {
            "classifiers": [
              {
                "clusterOutNoMatch": "$",
                "classOutNoMatch": "None",
                "modelClassId": 65535,
                "filters": [
                  {
                    "clusterOut": "$",
                    "classOut": "C0",
                    "minParticleSize": -1,
                    "maxParticleSize": -1,
                    "minCircularity": 0,
                    "snapAreaSize": 0
                  }
                ]
              }
            ]
          }
        },
        {
          "$imageFromClass": {
            "classesIn": [
              "0"
            ]
          }
        },
        {
          "$saveImage": {
            "compression": 0,
            "namePrefix": "_classified_B"
          }
        }
      ]
    },
    {
      "pipelineSetup": {
        "source": "FromBlank",
        "cStackIndex": 4,
        "zProjection": "MaxIntensity",
        "defaultClusterId": "E"
      },
      "pipelineSteps": [
        {
          "$colocalization": {
            "minIntersection": 0,
            "clusterOut": "$",
            "classOut": "C4",
            "objectsIn": [
              {
                "objectIn": {
                  "storeIdx": "$"
                },
                "clusterIn": "A",
                "classesIn": [
                  "C0"
                ]
              },
              {
                "objectIn": {
                  "storeIdx": "$"
                },
                "clusterIn": "B",
                "classesIn": [
                  "C0"
                ]
              }
            ]
          }
        },
        {
          "$intersection": {
            "function": "Count",
            "objectsIn": {
              "clusterIn": "A",
              "classesIn": [
                "C0"
              ]
            },
            "objectsInWith": {
              "clusterIn": "B",
              "classesIn": [
                "C0"
              ]
            }
          }
        },
        {
          "$intersection": {
            "function": "Reclassify",
            "objectsIn": {
              "clusterIn": "A",
              "classesIn": [
                "C0"
              ]
            },
            "objectsInWith": {
              "clusterIn": "B",
              "classesIn": [
                "C0"
              ]
            },
            "newClassId": "C7"
          }
        },
        {
          "$imageFromClass": {
            "classesIn": [
              "C4"
            ]
          }
        },
        {
          "$saveImage": {
            "compression": 0,
            "namePrefix": "_intersect"
          }
        }
      ]
    }
  ]
}
